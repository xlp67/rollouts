environments:
  dev:
    values:
      - clusterName: argocd-conf
---
repositories:
  - name: istio
    url: https://istio-release.storage.googleapis.com/charts

  - name: argo
    url: https://argoproj.github.io/argo-helm

  - name: cert-manager
    url: https://charts.jetstack.io

  - name: nginx
    url: https://helm.nginx.com/stable

helmDefaults:
  createNamespace: true

releases:
  - name: istio
    namespace: istio-system
    labels:
      app: istio.io
    chart: istio.io/istio
    version: "1.3.2"

  - name: argocd
    namespace: argocd
    labels:
      app: argocd
    chart: argo/argo-cd
    version: "~5.34.6"

  - name: argocd-rollouts
    namespace: argocd
    labels:
      app: argocd
    chart: argo/argo-rollouts
    version: "2.32.0"
    set:
      - name: dashboard.enabled
        value: true

  - name: cert-manager
    namespace: cert-manager
    chart: cert-manager/cert-manager
    version: 1.12.2
    hooks:
      - events: ["prepare"]
        command: "./cert-manager-crds.sh"
    values:
      - serviceAccount:
          annotations:
            {
              eks.amazonaws.com/role-arn: arn:aws:iam::916001899522:role/cert-manager,
            }

  - name: nginx-ingress
    namespace: nginx-ingress
    labels:
      app: nginx-ingress
    chart: nginx/nginx-ingress
    version: "0.18.1"
